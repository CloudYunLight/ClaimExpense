
# 报销跟踪系统 RESTful API 规范文档

## 基础信息

- **接口前缀**: `/api/v1`
- **数据格式**: `application/json`
- **认证方式**: JWT Token
- **请求头**:
  ```
  Authorization: Bearer {token}
  Content-Type: application/json
  ```

## 通用响应格式

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {}, // 根据接口返回，可为对象、数组或null
  "timestamp": 1634567890123 // 响应时间戳
}
```

- 分页响应模式
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 100,     // 总记录数
    "pages": 10,      // 总页数
    "current": 1,     // 当前页码
    "size": 10,       // 每页大小
    "records": []     // 数据列表
  },
  "timestamp": 1634567890123
}
```

**状态码说明**:
- `200`: 成功
- `400`: 请求参数错误
- `401`: 未授权/Token失效
- `403`: 权限不足
- `404`: 资源不存在
- `500`: 服务器内部错误

---

## 一、认证管理接口

### 1.1 用户登录
**接口**: `POST /api/v1/auth/login`

**请求参数**:
```json
{
  "username": "zhangsan",
  "password": "123456"
}
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userInfo": {
      "userId": 1,
      "username": "zhangsan",
      "realName": "张三",
      "role": 0, // 0-普通用户, 1-管理员
      "status": 1 // 1-正常, 0-锁定
    }
  },
  "timestamp": 1634567890123
}
```

---

### 1.2 修改密码
**接口**: `POST /api/v1/auth/ChangePassword`

这里需要配合前置登录接口使用，即先登录，再修改密码。带请求头

**请求参数**:
```json
{
  "oldPassword": "123456",
  "newPassword": "654321"
}
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "密码修改成功",
  "data": null,
  "timestamp": 1634567890123
}
```

### 1.3 用户登出
**接口**: `POST /api/v1/auth/logout`

**成功响应**:
```json
{ 
  "code": 200,
  "msg": "登出成功",
  "data": null,
  "timestamp": 1634567890123
}
```

### 1.4 获取当前登录用户信息 
**接口**: `GET /api/v1/auth/me`

**成功响应**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "userId": 1,
    "username": "zhangsan",
    "realName": "张三",
    "role": 0,
    "status": 1
  },
  "timestamp": 1634567890123
}
```


---

## 二、管理员接口

### 2.1 用户列表查询
**接口**: `GET /api/v1/admin/users`

**查询参数**:
```
?pageNum=1&pageSize=10&username=张&realName=三&status=1
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 45,
    "pages": 5,
    "current": 1,
    "size": 10,
    "records": [
      {
        "userId": 1,
        "username": "zhangsan",
        "realName": "张三",
        "role": 0,
        "status": 1,
        "createTime": "2024-01-01T10:00:00"
      }
    ]
  },
  "timestamp": 1634567890123
}
```

---

### 2.2 新增用户
**接口**: `POST /api/v1/admin/addUsers`

**请求参数**:
```json
{
  "username": "lisi",
  "realName": "李四",
}
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "用户创建成功",
  "data": {
    "userId": 2,
    "initialPassword": "init123" // 返回生成的初始密码
  },
  "timestamp": 1634567890123
}
```

**错误响应 (用户名重复)**:
```json
{
  "code": 409,
  "msg": "用户名已存在",
  "data": null,
  "timestamp": 1634567890123
}
```

---

### 2.3 重置用户密码
**接口**: `POST /api/v1/admin/users/{userId}/resetPassword`

**路径参数**: `userId` - 用户ID

**请求参数**: 无

**成功响应**:
```json
{
  "code": 200,
  "msg": "密码重置成功",
  "data": {
    "newPassword": "r4nd0mP@ss" // 生成的新随机密码
  },
  "timestamp": 1634567890123
}
```

---

### 2.4 启停用户账户
**接口**: `POST /api/v1/admin/users/{userId}/status`

**路径参数**: `userId` - 用户ID

**请求参数**:
```json
{
  "status": 0 // 0-锁定, 1-正常
}
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "账户状态更新成功",
  "data": "锁定成功",
  "timestamp": 1634567890123
}
```

---

## 三、报销清单接口

### 3.1 创建报销清单
**接口**: `POST /api/v1/lists/CreateLists`

**请求参数**:
```json
{
  "activityName": "团队建设活动",
}
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "清单创建成功",
  "data": {
    "listId": 1001
  }
}
```

---

### 3.2 查询个人清单列表
**接口**: `GET /api/v1/lists/SearchLists`

**查询参数**:
```
?pageNum=1&pageSize=10
&activityName=会议
&activityType=会议
&status=0
&startTime=2024-01-01&endTime=2024-12-31
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 23,
    "pageNum": 1,
    "pageSize": 10,
    "list": [
      {
        "listId": 1001,
        "activityName": "季度会议",
        "totalAmount": 1500.00,
        "status": 0, // 0-未报销, 1-已上交文件, 2-已回款
        "createTime": "2024-01-15 14:30:00",
        "updateTime": "2024-01-15 14:30:00"
      }
    ]
  },
  "timestamp": 1643123456789
}
```

---

### 3.3 查询清单详情
**接口**: `GET /api/v1/lists/{listId}`

**路径参数**: `listId` - 清单ID

**成功响应**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "listInfo": {
      "listId": 1001,
      "activityName": "季度会议",
      "activityType": "会议",
      "totalAmount": 1500.00,
      "status": 0,
      "createTime": "2024-01-15 14:30:00",
      "updateTime": "2024-01-15 14:30:00"
    },
    "bills": [
      {
        "billId": 2001,
        "paymentMethod": 0,
        "amount": 800.00,
        "remark": "餐费发票号: 123456",
        "createTime": "2024-01-15 15:00:00"
      },
      {
        "billId": 2002,
        "paymentMethod": 1,
        "amount": 700.00,
        "remark": "交通费",
        "createTime": "2024-01-15 15:30:00"
      }
    ]
  },
  "timestamp": 1640000000000
}
```

---

### 3.4 更新清单状态
**接口**: `POST /api/v1/lists/{listId}/status`

**路径参数**: `listId` - 清单ID

**请求参数**:
```json
{
  "status": 1 // 目标状态
}
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "状态更新成功",
  "data": 1,
  "timestamp": 1640000000000
}
```

---

### 3.5 删除清单
**接口**: `DELETE /api/v1/ListsDelete/{listId}`

**路径参数**: `listId` - 清单ID

**成功响应**:
```json
{
  "code": 200,
  "msg": "清单删除成功",
  "data": null,
  "timestamp": 1640000000000
}
```

---

## 四、账单管理接口

### 4.1 添加账单
**接口**: `POST /api/v1/bills`

**请求参数**:
```json
{
  "listId": 1001,
  "paymentMethod": 0, // 0-微信, 1-支付宝, 2-现金, 3-需要转交
  "amount": 500.00,
  "remark": "购买办公用品"
}
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "账单添加成功",
  "data": {
    "billId": 2003
  },
  "timestamp": 1634567890123
}
```

---

### 4.2 编辑账单
**接口**: `POST /api/v1/bills/{billId}`

**路径参数**: `billId` - 账单ID

**请求参数**:
```json
{
  "paymentMethod": 1,
  "amount": 550.00, 
  "remark": "购买办公用品及文具"
}
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "账单更新成功",
  "data": null,
  "timestamp": 1634567890123
}
```

---

### 4.3 删除账单
**接口**: `POST /api/v1/bills/delete/{billId}`

**路径参数**: `billId` - 账单ID

**成功响应**:
```json
{
  "code": 200,
  "msg": "账单删除成功",
  "data": null,
  "timestamp": 1634567890123
}
```

---

### 4.4 查询个人支付的账单
**接口**: `GET /api/v1/bills/my`

**查询参数**:
```
?pageNum=1&pageSize=10
&listId=1001
&paymentMethod=0
&startTime=2024-01-01&endTime=2024-12-31
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 15,
    "pages": 2,
    "current": 1,
    "size": 10,
    "records": [
      {
        "billId": 2001,
        "listId": 1001,
        "activityName": "季度会议",
        "paymentMethod": 0,
        "paymentMethodText": "微信",
        "amount": 800.00,
        "payerId": 1,
        "payerName": "张三",
        "remark": "餐费",
        "createTime": "2024-01-15T15:00:00"
      }
    ]
  },
  "timestamp": 1634567890123
}
```

---

## 五、数据大盘接口

### 5.1 获取个人报销汇总
**接口**: `GET /api/v1/dashboard/summary`

**查询参数**:
```
?startDate=2024-01-01&endDate=2024-01-31
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "totalListCount": 15,
    "totalAmount": 12500.50,
    "repaidAmount": 8500.00,
    "unrepaidAmount": 4000.50,
    "unrepaidListCount": 5,
    "submittedListCount": 3,
    "repaidListCount": 7
  },
  "timestamp": 1634567890123
}
```

---

### 5.2 获取报销状态分布
**接口**: `GET /api/v1/dashboard/status`

**查询参数**: 
```
?startDate=2024-01-01&endDate=2024-01-31
```

**成功响应**:
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": [
    {
      "status": 0,
      "statusCount": 5,
      "statusAmount": 4000.50,
      "percentage": 33.3
    },
  ],
  "timestamp": 1634567890123
}
```

